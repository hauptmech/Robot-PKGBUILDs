# This is an example PKGBUILD file. Use this as a start to creating your own,
# and remove these comments. For more information, see 'man PKGBUILD'.
# NOTE: Please fill out the license field for your package! If it is unknown,
# then please put 'unknown'.

# Maintainer: Your Name <youremail@domain.com>
pkgname=linux32-peak
pkgver=7.7
pkgrel=2
_kernelname=3.2.21-1-XENOMAI
epoch=
pkgdesc="peak CANbus driver"
arch=("x86_64" "i686")
url="http://www.peak-system.com/"
license=('GPL')
groups=()
depends=()
makedepends=('linux-headers')
checkdepends=()
optdepends=()
provides=('linux32-peak')
conflicts=('linux32-peak')
replaces=()
backup=()
options=()
install=peak.install
changelog=
source=("http://www.peak-system.com/fileadmin/media/linux/files/peak-linux-driver-7.7.tar.gz"
        "pcan_set_bitrate"
        "peak.install"
        'pcan.conf'
        'pcan-linux32'
)
noextract=()

build() {
  cd "$srcdir/peak-linux-driver-$pkgver"

  sed -i ../pcan-linux32 -f - <<'==='
/#pkgname=/ a\
pkgname="linux32-peak"
===
  #make
  make KERNEL_LOCATION=/usr/src/linux-$_kernelname 
}

package() {

  #Switch Script
  install -D -m755 "$srcdir"/pcan-linux32 "$pkgdir"/usr/bin/pcan-linux32
 
  sharedir="$pkgdir"/usr/share/linux32-peak
  cd "$srcdir/peak-linux-driver-$pkgver"
#  make DESTDIR="$pkgdir/" install
  cd driver
  install  -D pcan.ko $pkgdir/lib/modules/$_kernelname/misc/pcan.ko
  install -D -m 744 pcan_make_devices $sharedir/bin/pcan_make_devices
  install -D -m 744 udev/pcan_usb_minor_check.bash $sharedir/bin/pcan_usb_minor_check.bash
  install -D -m 744 udev/45-pcan.rules $sharedir/udev/45-pcan.rules
  install -D -m 644 udev/blacklist-peak.conf $sharedir/udev/blacklist-peak.conf
  install -D -m 644 pcan.h $sharedir/include/pcan.h
   
  cd ../lib
  TARGET=libpcan.so.0.6
  install -m 644 libpcan.h $sharedir/include/
  install -D $TARGET $sharedir/lib/$TARGET
 
  cd ../test
  install -D -m 755 receivetest $sharedir/bin/pcan-receivetest
  install -D -m 755 transmitest $sharedir/bin/pcan-transmitest
  install -D -m 755 bitratetest $sharedir/bin/pcan-bitratetest
  install -D -m 755 filtertest  $sharedir/bin/pcan-filtertest
  install -D -m 755 pcan-settings $sharedir/bin/pcan-settings

  cd ../Documentation
  install -D  PCAN-Driver_for_Linux_eng.pdf "$sharedir"/doc/PCAN-Driver_for_Linux_eng.pdf

  install -D "$srcdir"/pcan.conf "$sharedir"/etc/modprobe.d/pcan.conf
}

# vim:set ts=2 sw=2 et:
md5sums=('64872ea3a301f5097eba242886ac5484'
         '9e23101e0464f8a1a8c06e01a2092c56'
         '7773d605165fe237ba834c54db97e7f9'
         '9f1cb79a5175b455f88f109fe61b62db'
         '61ca363d9d1612bcc55143b2345fa92c')
