# This is an example PKGBUILD file. Use this as a start to creating your own,
# and remove these comments. For more information, see 'man PKGBUILD'.
# NOTE: Please fill out the license field for your package! If it is unknown,
# then please put 'unknown'.

# Maintainer: Your Name <youremail@domain.com>
pkgname=linux34-peak-chardev
pkgver=7.7
pkgrel=1
epoch=
pkgdesc="peak CANbus driver"
arch=("x86_64" "i686")
url="http://www.peak-system.com/"
license=('GPL')
groups=()
depends=()
makedepends=('linux-headers')
checkdepends=()
optdepends=()
provides=('linux34-peak')
conflicts=('linux34-peak')
replaces=()
backup=()
options=()
install=
changelog=
source=("http://www.peak-system.com/fileadmin/media/linux/files/peak-linux-driver-7.7.tar.gz")
noextract=()

build() {
  cd "$srcdir/$pkgname-$pkgver"
  make USB=USB_SUPPORT NET=NO
  #make KERNEL_LOCATION=/usr/src/linux-3.2.21-XENOMAI RT=XENOMAI
}

package() {
  cd "$srcdir/$pkgname-$pkgver"
#  make DESTDIR="$pkgdir/" install
  cd driver
  install  -D pcan.ko $pkgdir/lib/modules/$(uname -r)/misc/pcan.ko
  install -D -m 744 pcan_make_devices $pkgdir/usr/local/bin/pcan_make_devices
  install -m 744 udev/pcan_usb_minor_check.bash $pkgdir/usr/local/bin/
  install -D -m 744 udev/45-pcan.rules $pkgdir/etc/udev/rules.d/45-pcan.rules
  install -D -m 644 udev/blacklist-peak.conf $pkgdir/etc/modprobe.d/blacklist-peak.conf
  install -D -m 644 pcan.h $pkgdir/usr/include/pcan.h/pcan.h
   
  cd ../lib
  TARGET=libpcan.so.0.6
  install -m 644 libpcan.h $pkgdir/usr/include/
  install -D $TARGET $pkgdir/usr/lib/$TARGET
  ln -s $pkgdir/usr/lib/$TARGET $pkgdir/usr/lib/libpcan.so.0
  ln -s $pkgdir/usr/lib/$TARGET $pkgdir/usr/lib/libpcan.so
 
  cd ../test
  install receivetest $pkgdir/usr/local/bin
  install transmitest $pkgdir/usr/local/bin
  install bitratetest $pkgdir/usr/local/bin
  install filtertest  $pkgdir/usr/local/bin
  install pcan-settings $pkgdir/usr/local/bin 
}

# vim:set ts=2 sw=2 et:
md5sums=('64872ea3a301f5097eba242886ac5484')
